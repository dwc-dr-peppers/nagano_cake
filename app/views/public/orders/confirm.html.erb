<div class="container">

  <div class="row row-col-9">
    <div class="col-1"></div>
    <h4>注文情報確認</h4>
  </div>

  <div class="row">
    <div class="col-md-7">
      <table class="table table-bordered">
        <thead class="table table-secondary">
          <tr>
            <th>商品名</th>
            <th>単価(税込)</th>
            <th>数量</th>
            <th>小計</th>
          </tr>
        </thead>

        <% @cart_items.each do |cart|%>
          <tbody class="table table-bordered col-md-3">
            <tr>
              <td><%= cart.item.name %></td>
              <td><%= cart.item.with_tax_price.to_s(:delimited) %></td>
              <td><%= cart.quantitiy%></td>
              <td><%= cart.subtotal.to_s(:delimited) %></td>
            </tr>
              <% @total += cart.subtotal %>
          </tbody>
        <% end %>
      </table>
    </div>

    <div class="col-md-2 offset-1">
      <% @totalamount = @total + @postage %>
      <table>
        <tr class="table table-bordered">
          <td class="table table-bordered table-secondary">送料</td>
          <td class="table"><%= @postage %></td>
        </tr>
        <tr class="table table-bordered">
          <td class="table table-secondary">商品合計</td>
          <td><%= @total.to_s(:delimited) %></td>
        </tr>
        <tr class="table table-bordered">
          <td class="table table-secondary">請求金額</td>
          <td><%= @totalamount.to_s(:delimited) %></td>
        </tr>
      </table>
    </div>
  </div>

  <%= form_with model: @order, url: orders_path, method: :post do |f| %>
    <div class="container">
      <div class="row">
        <strong>支払方法</strong>
        <div class="col">
          <% if params[:order][:payment_way] == "credit_card" %>
            <%= f.label :payment_way, Order.payment_ways_i18n[:credit_card] %>
            <%= f.hidden_field :payment_way, :value => Order.payment_ways[:credit_card] %>
          <% else %>
            <%= f.label :payment_way, Order.payment_ways_i18n[:transfer]%>
            <%= f.hidden_field :payment_way, :value => Order.payment_ways[:transfer] %>
          <% end %>
        </div>
      </div>
    </div>
    <%# 新しいお届け先のデータ %>
    <% if params[:order][:address_select] == "3" %>
      <%= f.hidden_field :address_select, :value => 3 %>
    <% end %>

    <div class="container">
      <div class="row">
        <strong>お届け先</strong>
        <div class="col">
          <%= "〒" %>
          <%= @order.postcode %>
          <%= f.hidden_field :postcode, :value => @order.postcode %>
          <%= @order.address %>
          <%= f.hidden_field :address, :value => @order.address %>
          <br>
          <%= @order.shipping_name %>
          <%= f.hidden_field :shipping_name, :value => @order.shipping_name %>
        </div>
      </div>
    </div>
      <%= f.hidden_field :postage, :value => @postage %>
      <%= f.hidden_field :total_amount, :value => @totalamount %>
  </div>
  <div class="row">
    <%= f.submit "注文を確定する", class:"btn btn-success mx-auto" %>
  </div>
  <% end %>
</div>